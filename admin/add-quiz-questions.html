



<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>إضافة سؤال اختبار</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <h2>إضافة سؤال لاختبار</h2>

  <label>اختر الصف:</label>
  <select id="gradeSelect">
    <option value="">-- اختر الصف --</option>
    <option value="الأول">الصف الأول الثانوي</option>
    <option value="الثاني">الصف الثاني الثانوي</option>
    <option value="الثالث">الصف الثالث الثانوي</option>
  </select>

  <br><label>اختر الكورس:</label>
  <select id="courseSelect"></select>

  <br><label>اختر المحاضرة:</label>
  <select id="lectureSelect"></select>

  <br><label>ID الاختبار:</label>
  <select id="quizIdSelect"></select>

  <br><label>نص السؤال:</label>
  <input type="text" id="questionText" />

  <br><label>الاختيار 1:</label><input type="text" id="option1" />
  <br><label>الاختيار 2:</label><input type="text" id="option2" />
  <br><label>الاختيار 3:</label><input type="text" id="option3" />
  <br><label>الاختيار 4:</label><input type="text" id="option4" />

  <br><label>رقم الإجابة الصحيحة (1-4):</label>
  <input type="number" id="correctIndex" min="1" max="4" />

  <br><label>رفع صورة (اختياري):</label>
  <input type="file" id="imageInput" />

  <br><button onclick="addQuestion()">إضافة</button>

  <div id="result"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBoPJbx5v6EkOqxOJkbhzHqIJdAByh79Rg",
      authDomain: "hhhhhh-d4fb8.firebaseapp.com",
      projectId: "hhhhhh-d4fb8"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const gradeSelect = document.getElementById("gradeSelect");
    const courseSelect = document.getElementById("courseSelect");
    const lectureSelect = document.getElementById("lectureSelect");
    const quizIdSelect = document.getElementById("quizIdSelect");

    gradeSelect.addEventListener("change", async () => {
      const grade = gradeSelect.value;
      courseSelect.innerHTML = "";
      const snap = await db.collection("courses").where("grade", "==", grade).get();
      snap.forEach(doc => {
        courseSelect.innerHTML += `<option value="${doc.id}">${doc.data().name}</option>`;
      });
    });

    courseSelect.addEventListener("change", async () => {
      lectureSelect.innerHTML = "";
      const snap = await db.collection("lectures").where("courseId", "==", courseSelect.value).get();
      snap.forEach(doc => {
        lectureSelect.innerHTML += `<option value="${doc.id}">${doc.data().lectureTitle}</option>`;
      });
    });

    lectureSelect.addEventListener("change", async () => {
      quizIdSelect.innerHTML = "";
      const snap = await db.collection("lectureContent")
        .where("lectureId", "==", lectureSelect.value)
        .where("type", "==", "quiz").get();
      snap.forEach(doc => {
        quizIdSelect.innerHTML += `<option value="${doc.data().url}">${doc.data().url}</option>`;
      });
    });

    async function addQuestion() {
      const q = {
        question: document.getElementById("questionText").value,
        options: [
          document.getElementById("option1").value,
          document.getElementById("option2").value,
          document.getElementById("option3").value,
          document.getElementById("option4").value
        ],
        correctIndex: parseInt(document.getElementById("correctIndex").value) - 1,
        image: ""
      };

      const file = document.getElementById("imageInput").files[0];
      const quizId = quizIdSelect.value;

      if (file) {
        const storageRef = firebase.storage().ref(`quizImages/${Date.now()}_${file.name}`);
        await storageRef.put(file);
        q.image = await storageRef.getDownloadURL();
      }

      await db.collection("quizzes").doc(quizId).collection("questions").add(q);
      document.getElementById("result").textContent = "✅ تم إضافة السؤال بنجاح.";
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="نظام تسجيل الطلاب الجدد - معهد عبدالرحمن السقا">
  <title>تسجيل طالب جديد | منصة عبدالرحمن السقا</title>
  
  <!-- Favicon -->
  <link rel="icon" href="https://example.com/favicon.ico" type="image/x-icon">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>
  
  <!-- Custom Tailwind Config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: {
              500: '#4f46e5',
              600: '#4338ca',
            },
            secondary: {
              500: '#10b981',
              600: '#059669',
            }
          },
          fontFamily: {
            'sans': ['Tajawal', 'sans-serif'],
          },
          boxShadow: {
            'xl': '0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)',
            '2xl': '0 25px 50px -12px rgba(0, 0, 0, 0.25)',
          }
        }
      }
    }
  </script>
  
  <!-- Google Fonts - Tajawal -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
  
  <style>
    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
    
    /* Input Focus Effects */
    .input-focus-effect:focus {
      box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.3);
      transition: all 0.3s ease;
    }
    
    /* Button Hover Effects */
    .btn-hover-effect:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px -5px rgba(79, 70, 229, 0.4);
    }
    
    /* File Input Custom Style */
    .file-input::-webkit-file-upload-button {
      visibility: hidden;
    }
    .file-input::before {
      content: 'اختر صورة';
      display: inline-block;
      background: linear-gradient(to bottom, #f9f9f9, #e3e3e3);
      border: 1px solid #999;
      border-radius: 6px;
      padding: 8px 16px;
      outline: none;
      white-space: nowrap;
      cursor: pointer;
      font-weight: 500;
      font-size: 14px;
      color: #555;
    }
    .file-input:hover::before {
      border-color: #4f46e5;
    }
    .file-input:active::before {
      background: linear-gradient(to bottom, #e3e3e3, #f9f9f9);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-blue-50 min-h-screen flex items-center justify-center p-4 font-sans">
  <!-- Animated Background Elements -->
  <div class="fixed top-0 left-0 w-full h-full overflow-hidden z-0">
    <div class="absolute top-20 left-20 w-64 h-64 bg-blue-100 rounded-full opacity-20 animate-blob animation-delay-2000"></div>
    <div class="absolute bottom-20 right-20 w-80 h-80 bg-indigo-100 rounded-full opacity-20 animate-blob animation-delay-4000"></div>
    <div class="absolute top-1/2 right-1/4 w-72 h-72 bg-purple-100 rounded-full opacity-20 animate-blob"></div>
  </div>

  <!-- Main Card -->
  <div class="bg-white/90 backdrop-blur-md shadow-2xl rounded-3xl p-8 max-w-2xl w-full relative z-10 border border-white/20">
    <!-- Logo Header -->
    <div class="flex justify-center mb-6">
      <div class="bg-gradient-to-r from-primary-500 to-indigo-600 p-3 rounded-xl shadow-lg inline-flex items-center">
        <i class="fas fa-graduation-cap text-white text-3xl mr-3"></i>
        <span class="text-white text-2xl font-bold">منصة عبدالرحمن السقا</span>
      </div>
    </div>
    
    <!-- Welcome Message -->
    <h2 class="text-4xl font-bold text-center text-gray-800 mb-2">
      مرحبًا بك في عائلة 
      <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary-500 to-indigo-600">عبدالرحمن السقا</span>
    </h2>
    <p class="text-center text-gray-600 mb-8 text-lg">نظام التسجيل الإلكتروني للطلاب الجدد</p>
    
    <!-- Registration Form -->
    <form id="registerForm" class="space-y-6">
      <!-- Full Name -->
      <div class="relative">
        <label for="fullName" class="block text-sm font-medium text-gray-700 mb-1">الاسم الكامل</label>
        <div class="relative">
          <input id="fullName" type="text" placeholder="أدخل اسمك الكامل كما في الوثائق الرسمية" 
                 class="w-full p-4 pr-12 border-2 border-gray-200 rounded-xl input-focus-effect focus:border-primary-500 transition-all duration-300">
          <i class="fas fa-user absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        </div>
      </div>
      
      <!-- Student Number -->
      <div class="relative">
        <label for="studentNumber" class="block text-sm font-medium text-gray-700 mb-1">رقم الطالب</label>
        <div class="relative">
          <input id="studentNumber" type="text" placeholder="أدخل رقم الطالب المسجل بالمعهد" 
                 class="w-full p-4 pr-12 border-2 border-gray-200 rounded-xl input-focus-effect focus:border-primary-500 transition-all duration-300">
          <i class="fas fa-id-card absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        </div>
      </div>
      
      <!-- Parent Numbers -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Father Number -->
        <div class="relative">
          <label for="fatherNumber" class="block text-sm font-medium text-gray-700 mb-1">رقم ولي الأمر (الأب)</label>
          <div class="relative">
            <input id="fatherNumber" type="text" placeholder="رقم الجوال" 
                   class="w-full p-4 pr-12 border-2 border-gray-200 rounded-xl input-focus-effect focus:border-primary-500 transition-all duration-300">
            <i class="fas fa-male absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
        </div>
        
        <!-- Mother Number -->
        <div class="relative">
          <label for="motherNumber" class="block text-sm font-medium text-gray-700 mb-1">رقم ولي الأمر (الأم)</label>
          <div class="relative">
            <input id="motherNumber" type="text" placeholder="رقم الجوال" 
                   class="w-full p-4 pr-12 border-2 border-gray-200 rounded-xl input-focus-effect focus:border-primary-500 transition-all duration-300">
            <i class="fas fa-female absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          </div>
        </div>
      </div>
      
      <!-- Password -->
      <div class="relative">
        <label for="password" class="block text-sm font-medium text-gray-700 mb-1">كلمة المرور</label>
        <div class="relative">
          <input id="password" type="password" placeholder="أنشئ كلمة مرور قوية" 
                 class="w-full p-4 pr-12 border-2 border-gray-200 rounded-xl input-focus-effect focus:border-primary-500 transition-all duration-300">
          <i class="fas fa-lock absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
          <button type="button" class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-primary-500" id="togglePassword">
            <i class="fas fa-eye"></i>
          </button>
        </div>
        <p class="text-xs text-gray-500 mt-1">يجب أن تحتوي كلمة المرور على 8 أحرف على الأقل</p>
      </div>
      
      <!-- Selfie Upload -->
      <div class="relative">
        <label for="selfie" class="block text-sm font-medium text-gray-700 mb-1">صورة شخصية حديثة</label>
        <div class="flex items-center justify-center w-full">
          <label for="selfie" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-xl cursor-pointer bg-gray-50 hover:bg-gray-100 transition">
            <div class="flex flex-col items-center justify-center pt-5 pb-6">
              <i class="fas fa-camera text-2xl text-gray-400 mb-2"></i>
              <p class="mb-2 text-sm text-gray-500"><span class="font-semibold">انقر لرفع الصورة</span></p>
              <p class="text-xs text-gray-500">JPEG, PNG (الحجم الأقصى 5MB)</p>
            </div>
            <input id="selfie" type="file" accept="image/*" class="hidden" />
          </label>
        </div>
        <div id="previewContainer" class="mt-2 hidden">
          <img id="imagePreview" class="h-24 rounded-lg border border-gray-200" src="#" alt="صورة المعاينة">
        </div>
      </div>
      
      <!-- Terms and Conditions -->
      <div class="flex items-start">
        <div class="flex items-center h-5">
          <input id="terms" type="checkbox" class="w-4 h-4 border border-gray-300 rounded bg-gray-50 focus:ring-3 focus:ring-primary-300" required>
        </div>
        <label for="terms" class="mr-2 text-sm font-medium text-gray-700">
          أوافق على <a href="#" class="text-primary-600 hover:underline">الشروط والأحكام</a> و
          <a href="#" class="text-primary-600 hover:underline">سياسة الخصوصية</a>
        </label>
      </div>
      
      <!-- Submit Button -->
      <button type="submit" 
              class="w-full bg-gradient-to-r from-primary-500 to-indigo-600 hover:from-primary-600 hover:to-indigo-700 text-white py-4 rounded-xl font-bold text-lg transition-all duration-300 btn-hover-effect shadow-lg">
        <i class="fas fa-paper-plane mr-2"></i> تقديم الطلب
      </button>
    </form>

    <!-- Success Message -->
    <div id="successMsg" class="text-center hidden">
      <div class="bg-green-50 border border-green-200 rounded-xl p-6 shadow-inner">
        <div class="flex justify-center mb-4">
          <div class="bg-green-100 p-3 rounded-full">
            <i class="fas fa-check-circle text-green-600 text-3xl"></i>
          </div>
        </div>
        <h3 class="text-2xl font-bold text-green-800 mb-2">تم التقديم بنجاح!</h3>
        <p class="text-green-600 mb-4">سيتم مراجعة طلبك والرد عليك خلال 48 ساعة</p>
        <p class="text-sm text-gray-600">رقم الطلب: <span id="requestNumber" class="font-mono font-bold"></span></p>
      </div>
    </div>
    
    <!-- Footer -->
    <div class="mt-8 text-center text-sm text-gray-500 border-t border-gray-100 pt-6">
      <p>جميع الحقوق محفوظة &copy; <span id="currentYear"></span> منصة عبدالرحمن السقا</p>
      <p class="mt-1">للتواصل: <a href="tel:+966123456789" class="text-primary-600 hover:underline">+20 10 93767923</a></p>
    </div>
  </div>

  <script>
    // Current Year for Footer
    document.getElementById('currentYear').textContent = new Date().getFullYear();
    
    // Toggle Password Visibility
    document.getElementById('togglePassword').addEventListener('click', function() {
      const passwordInput = document.getElementById('password');
      const icon = this.querySelector('i');
      
      if (passwordInput.type === 'password') {
        passwordInput.type = 'text';
        icon.classList.replace('fa-eye', 'fa-eye-slash');
      } else {
        passwordInput.type = 'password';
        icon.classList.replace('fa-eye-slash', 'fa-eye');
      }
    });
    
    // Image Preview
    document.getElementById('selfie').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          const preview = document.getElementById('imagePreview');
          preview.src = event.target.result;
          document.getElementById('previewContainer').classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      }
    });
    
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID",
      measurementId: "G-MEASUREMENT_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Form Submission
    const form = document.getElementById("registerForm");
    const successMsg = document.getElementById("successMsg");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      
      // Validate Terms Checkbox
      if (!document.getElementById('terms').checked) {
        alert('يجب الموافقة على الشروط والأحكام أولاً');
        return;
      }

      // Show Loading State
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalBtnText = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> جاري المعالجة...';
      submitBtn.disabled = true;

      // Get Form Values
      const fullName = document.getElementById("fullName").value.trim();
      const studentNumber = document.getElementById("studentNumber").value.trim();
      const fatherNumber = document.getElementById("fatherNumber").value.trim();
      const motherNumber = document.getElementById("motherNumber").value.trim();
      const password = document.getElementById("password").value;
      const selfieFile = document.getElementById("selfie").files[0];

      // Simple Validation
      if (!fullName || !studentNumber || !fatherNumber || !password || !selfieFile) {
        alert('الرجاء ملء جميع الحقول المطلوبة');
        submitBtn.innerHTML = originalBtnText;
        submitBtn.disabled = false;
        return;
      }

      if (password.length < 8) {
        alert('كلمة المرور يجب أن تكون 8 أحرف على الأقل');
        submitBtn.innerHTML = originalBtnText;
        submitBtn.disabled = false;
        return;
      }

      const id = 'STU-' + Date.now().toString();

      try {
        // Upload Selfie to Storage
        const storageRef = storage.ref().child(`students/${id}/selfie.jpg`);
        const uploadTask = storageRef.put(selfieFile);
        
        // Show Upload Progress
        uploadTask.on('state_changed', 
          (snapshot) => {
            const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
            submitBtn.innerHTML = `<i class="fas fa-cloud-upload-alt mr-2"></i> جاري رفع الصورة ${Math.round(progress)}%`;
          },
          (error) => {
            throw error;
          },
          async () => {
            // Get Download URL
            const selfieURL = await uploadTask.snapshot.ref.getDownloadURL();

            // Save Student Data to Firestore
            await db.collection("students").doc(id).set({
              id,
              fullName,
              studentNumber,
              fatherNumber,
              motherNumber,
              password,
              selfieURL,
              status: "في انتظار الموافقة",
              createdAt: firebase.firestore.FieldValue.serverTimestamp(),
              updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            });

            // Show Success Message
            form.classList.add("hidden");
            successMsg.classList.remove("hidden");
            document.getElementById("requestNumber").textContent = id;
            
            // Reset Form (for demo purposes)
            setTimeout(() => {
              form.reset();
              form.classList.remove("hidden");
              successMsg.classList.add("hidden");
              document.getElementById('previewContainer').classList.add('hidden');
              submitBtn.innerHTML = originalBtnText;
              submitBtn.disabled = false;
            }, 5000);
          }
        );

      } catch (error) {
        console.error("Error:", error);
        alert("حدث خطأ أثناء التسجيل: " + error.message);
        submitBtn.innerHTML = originalBtnText;
        submitBtn.disabled = false;
      }
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>الاختبار</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js"></script>
  <style>
    body { font-family: Arial; padding: 20px; direction: rtl; }
    .question { margin-bottom: 20px; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
    .wrong { background: #fdd; }
    button { padding: 10px; border: none; border-radius: 8px; background: #4CAF50; color: white; cursor: pointer; }
  </style>
</head>
<body>

  <h1 id="quizTitle">جاري التحميل...</h1>
  <p id="quizDesc"></p>

  <div id="questionsContainer"></div>
  <button id="submitBtn">تسليم الإجابات</button>

  <script>
    // إعداد Firebase
    const firebaseConfig = {
  apiKey: "AIzaSyBoPJbx5v6EkOqxOJkbhzHqIJdAByh79Rg",
  authDomain: "hhhhhh-d4fb8.firebaseapp.com",
  databaseURL: "https://hhhhhh-d4fb8-default-rtdb.firebaseio.com",
  projectId: "hhhhhh-d4fb8",
  storageBucket: "hhhhhh-d4fb8.appspot.com",
  messagingSenderId: "24512338206",
  appId: "1:24512338206:web:dfe045db59bd3434a2110f",
  measurementId: "G-HD4R7GNQ5H"
};


    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // جلب ID من الرابط
    const urlParams = new URLSearchParams(window.location.search);
    const quizId = urlParams.get("id");

    const quizTitle = document.getElementById("quizTitle");
    const quizDesc = document.getElementById("quizDesc");
    const questionsContainer = document.getElementById("questionsContainer");
    const submitBtn = document.getElementById("submitBtn");

    let questions = [];

    async function loadQuiz() {
      if (!quizId) {
        quizTitle.innerText = "الاختبار غير موجود";
        return;
      }

      // جلب بيانات الاختبار
      const quizRef = db.collection("quizQuestions").doc(quizId);
      const quizDoc = await quizRef.get();

      if (!quizDoc.exists) {
        quizTitle.innerText = "الاختبار غير موجود";
        return;
      }

      quizTitle.innerText = quizDoc.data().title || "اختبار بدون اسم";
      quizDesc.innerText = quizDoc.data().description || "";

      // جلب الأسئلة
      const questionsSnap = await quizRef.collection("questions").get();
      questions = questionsSnap.docs.map(doc => ({ id: doc.id, ...doc.data() }));

      displayQuestions();
    }

    function displayQuestions() {
      questionsContainer.innerHTML = "";
      questions.forEach((q, index) => {
        const div = document.createElement("div");
        div.className = "question";
        div.innerHTML = `
          <p>${index + 1}. ${q.question}</p>
          ${q.options.map((opt, i) => `
            <label><input type="radio" name="q${index}" value="${i}"> ${opt}</label><br>
          `).join("")}
        `;
        questionsContainer.appendChild(div);
      });
    }

    submitBtn.addEventListener("click", () => {
      let score = 0;
      let wrongQuestions = [];

      questions.forEach((q, index) => {
        const selected = document.querySelector(`input[name="q${index}"]:checked`);
        if (selected && parseInt(selected.value) === q.correct) {
          score++;
        } else {
          wrongQuestions.push(index + 1);
          questionsContainer.children[index].classList.add("wrong");
        }
      });

      alert(`درجتك: ${score} من ${questions.length}\nالأسئلة الغلط: ${wrongQuestions.join(", ") || "لا يوجد"}\nسيتم تبليغ ولي الأمر بتلك الدرجة`);

      // حفظ النتيجة
      db.collection("quizQuestions").doc(quizId).collection("results").add({
        student: "طالب1",
        score: score,
        total: questions.length,
        date: new Date()
      });
    });

    loadQuiz();
  </script>
</body>
</html>





